package com.example.wastesortmock.data

/**
 * Классификатор отходов по названию предмета
 * Расширенная база ключевых слов для определения категории
 */
object WasteCategoryClassifier {
    
    private val plasticKeywords = listOf(
        // Основные
        "пластик", "пластиковая", "пластиковый", "пластиковое", "пластмасс",
        
        // Бутылки и ёмкости
        "бутылка", "бутылки", "бутылочка", "пэт", "pet", "пвх", "pvc",
        "контейнер", "контейнеры", "тар", "тарка", "упаковка пластик",
        
        // Пакеты
        "пакет", "пакеты", "пакетик", "полиэтилен", "полиэтиленовый",
        "пакет полиэтилен", "пакет целлофан",
        
        // Посуда одноразовая
        "стакан пластик", "стакан однораз", "тарелка пластик", "тарелка однораз",
        "ложка пластик", "вилка пластик", "нож пластик",
        "посуда однораз", "одноразовая посуда",
        
        // Упаковка
        "упаковка", "обертка пластик", "пленка", "стретч пленка",
        "пузырчат", "пенопласт", "пенополистирол",
        
        // Йогурты и молочка
        "йогурт", "творог упаковка", "сметана упаковка", "майонез упаковка",
        "кефир упаковка", "молоко упаковка",
        
        // Бытовая химия
        "шампунь бутылка", "гель душ", "мыло жидк", "моющее средство",
        "стиральный порошок", "кондиционер для белья",
        
        // Разное пластиковое
        "крышка пластик", "крышечка", "канистра", "ведро пластик",
        "ящик пластик", "корзина пластик", "коробка пластик"
    )
    
    private val metalKeywords = listOf(
        // Основные
        "металл", "металлический", "металлическая", "металлическое",
        
        // Банки
        "банка", "банки", "банка алюмин", "банка консерв", "банка жестяная",
        "банка жесть", "консервная банка", "пивная банка",
        
        // Алюминий
        "алюминий", "алюминиевый", "алюминиевая", "алюминиевое",
        "жесть", "жестяной", "жестяная", "жестяное",
        
        // Фольга
        "фольга", "фольга алюмин", "фольга пищев", "упаковка фольга",
        
        // Крышки и пробки
        "крышка металл", "крышка жестяная", "пробка металл",
        
        // Тара
        "канистра металл", "бочка", "ведро металл", "ящик металл",
        "коробка металл", "корзина металл",
        
        // Разное
        "проволока", "гвоздь", "болт", "гайка", "скрепка",
        "консервы", "тушенка", "шпроты", "сардины", "ананасы консерв",
        
        // Напитки
        "лимонад банка", "кола банка", "энергетик банка", "сок банка",
        
        // Железо
        "железо", "железный", "железная", "сталь", "стальной"
    )
    
    private val paperKeywords = listOf(
        // Основные
        "бумага", "бумажный", "бумажная", "бумажное",
        "картон", "картонный", "картонная", "картонное","пергамент","тетра",
        
        // Газеты и журналы
        "газета", "газеты", "газетка", "журнал", "журналы",
        "каталог", "каталоги", "брошюра", "брошюры",
        
        // Книги и тетради
        "кни", "книги", "книжка", "тетрадь", "тетради", "тетрадка",
        "блокнот", "блокноты", "альбом", "альбомы",
        
        // Упаковка бумажная
        "коробка", "коробки", "коробка картон", "коробочка",
        "пакет бумажн", "мешок бумажн", "упаковка бумаг",
        "обертка бумаг", "обертка", "обертки",
        
        // Офисная бумага
        "бумага а4", "лист", "листы", "папка", "папки",
        "конверт", "конверты", "открытка", "открытки",
        
        // Разное
        "салфетка", "салфетки", "полотенце бумажн", "туалетная бумага",
        "рулон туалет", "рулон бумаг", "кухонные полотенца",
        "гофрированная бумага", "крафт бумага", "крафт пакет",
        
        // Еда упаковка
        "пакет от муки", "пакет от сахара", "пакет от круп",
        "коробка от конфет", "коробка от печенья", "коробка от чая",
        "пачка", "пачки", "упаковка от еды"
    )
    
    private val glassKeywords = listOf(
        // Основные
        "стекло", "стеклянный", "стеклянная", "стеклянное",
        
        // Бутылки
        "бутылка стекл", "бутылка", "бутылки стекл", "бутылочка стекл",
        "пивная бутылка", "винная бутылка", "водка бутылка",
        "лимонад бутылка", "сок бутылка", "молоко бутылка",
        
        // Банки
        "банка стекл", "банка варень", "банка солень", "банка компот",
        "банка томат", "банка огурц", "банка гриб", "банка маринад",
        "стеклянная банка", "банка из стекла",
        
        // Стаканы и посуда
        "стакан", "стаканы", "стаканчик", "бокал", "бокалы",
        "рюмка", "рюмки", "фужер", "фужеры", "кружка стекл",
        
        // Разное
        "ваза", "вазы", "банка от меда", "банка от соуса",
        "банка от майонеза", "банка от горчицы", "банка от кетчупа",
        
        // Лампочки (не перерабатываются, но это стекло)
        "лампочка", "лампочки", "лампа накалив"
    )
    
    private val otherKeywords = listOf(
        // Смешанные материалы
        "тетрапак", "тетра пак", "сок тетрапак", "молоко тетрапак",
        "упаковка смешан", "композитная упаковка",
        
        // Одноразовая посуда смешанная
        "стакан бумажн", "стакан однораз", "тарелка однораз",
        "посуда однораз", "одноразовая посуда",
        
        // Грязная упаковка
        "упаковка грязн", "грязная упаковка", "жирная упаковка",
        "упаковка с остатками", "упаковка с едой",
        
        // Специфичные материалы
        "резина", "резиновый", "керамика", "керамический",
        "полистирол вспенен", "пенопласт загрязнен",
        
        // Опасные отходы
        "батарейка", "батарейки", "аккумулятор", "термометр",
        "лампочка энергосбереж", "лампочка светодиод",
        
        // Органические отходы в упаковке
        "упаковка от мяса", "упаковка от рыбы", "упаковка от продуктов",
        "упаковка с остатками пищи",
        
        // Неопределенное
        "разное", "прочее", "другое", "неопределен"
    )
    
    /**
     * Определяет категорию отходов по названию предмета
     * @param itemName название предмета
     * @return ID категории ("plastic", "metal", "paper", "glass", "other")
     */
    fun classify(itemName: String): String {
        val query = itemName.lowercase().trim()
        
        // Проверяем каждую категорию по ключевым словам
        val categoryScores = mapOf(
            "plastic" to countMatches(query, plasticKeywords),
            "metal" to countMatches(query, metalKeywords),
            "paper" to countMatches(query, paperKeywords),
            "glass" to countMatches(query, glassKeywords),
            "other" to countMatches(query, otherKeywords)
        )
        
        // Ищем категорию с наибольшим количеством совпадений
        val maxScore = categoryScores.values.maxOrNull() ?: 0
        
        // Если есть совпадения, возвращаем категорию с максимальным счетом
        if (maxScore > 0) {
            return categoryScores.entries
                .firstOrNull { it.value == maxScore }?.key ?: "other"
        }
        
        // Специальные правила для сложных случаев
        return classifySpecialCases(query)
    }
    
    /**
     * Подсчитывает количество совпадений ключевых слов в строке
     */
    private fun countMatches(text: String, keywords: List<String>): Int {
        return keywords.count { keyword ->
            text.contains(keyword, ignoreCase = true)
        }
    }
    
    /**
     * Обработка специальных случаев
     */
    private fun classifySpecialCases(query: String): String {
        // Если ничего не найдено, но есть упоминание "бутылка" без уточнений - скорее всего пластик
        if (query.contains("бутылка") && !query.contains("стекл")) {
            return "plastic"
        }
        
        // "Банка" без уточнений - проверяем контекст
        if (query.contains("банка")) {
            when {
                query.contains("консерв") || query.contains("алюмин") || query.contains("жесть") -> return "metal"
                query.contains("варень") || query.contains("стекл") || query.contains("солень") -> return "glass"
                else -> return "metal" // По умолчанию банки металлические
            }
        }
        
        // "Коробка" без уточнений - скорее всего бумага/картон
        if (query.contains("коробка") && !query.contains("пластик") && !query.contains("металл")) {
            return "paper"
        }
        
        // "Упаковка" без уточнений - проверяем контекст
        if (query.contains("упаковка") && !query.contains("пластик") && 
            !query.contains("металл") && !query.contains("стекл") && !query.contains("бумаг")) {
            return "plastic" // По умолчанию пластик
        }
        
        // Если совсем ничего не понятно - "другое"
        return "other"
    }
}

